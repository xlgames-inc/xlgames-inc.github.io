<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title></title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="author" content="XL Games">

    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Le styles -->
<link href='/assets/stylesheets/bootstrap.min-93b47f97c3444c4711853ed5140d82a1.css' type='text/css' rel='stylesheet' media='all'>
<link href='/assets/stylesheets/style-1dcb1d39791f3457afa56d279fcf0945.css' type='text/css' rel='stylesheet' media='all'>
<link href='/assets/stylesheets/google_prettify/sons-of-obsidian-5e05343fd0c18e0a05231023b643245c.css' type='text/css' rel='stylesheet' media='all'>
    <!-- Le fav and touch icons -->
  <!-- Update these with your own images
    <link rel="shortcut icon" href="images/favicon.ico">
    <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
  -->
  </head>

  <body>

    <div class="navbar">
      <div class="navbar-inner">
        <div class="container-narrow">
          <a class="brand" href="/">XLE development blog</a>
          <ul class="nav">
              
                <li><a href="/tags">Tags</a></li>
              
              
                <li><a href="/archive">Archive</a></li>
              
              
                <li><a href="/about">About</a></li>
              
          </ul>
        </div>
      </div>
    </div>

    <div class="container-narrow">

      <div class="content">
        <div class="row-fluid">
  <div class="span12">
      <div class="_root">
        <h3 class="title"><a href="/about">About</a><br/> <span class="date"></span></h3>

        <div class="summary">
<p>XLE is an open-source game engine (currently in development).</p>

<p>Find us on Github:
    <a href="https://github.com/xlgames-inc/XLE">https://github.com/xlgames-inc/XLE</a></p>

<p>Documentation starting point:
    <a href="https://github.com/xlgames-inc/XLE/wiki">https://github.com/xlgames-inc/XLE/wiki</a></p>
</div>

        <div class="more">
          <a href="/about" class="btn btn-small">read more..</a>
        </div>
      </div>
      <div class="_root">
        <h3 class="title"><a href="/archive">Archive</a><br/> <span class="date"></span></h3>

        <div class="summary ellipsis">
  <h2>2017</h2>
    <h3>February</h3>
    <ul>
      <li>
<span>February 12, 2017</span> » <a href="/posts/sphericalharmonics2">Spherical Harmonics and applications in real time graphics (part 3)</a>
</li>
    </ul>
    <h3>January</h3>
    <ul>
      <li>
<span>January 31, 2017</span> » <a href="/posts/vulkanworkshop2017">Vulkan Workshop / DevU 2017</a>
</li>
      <li>
<span>January 08, 2017</span> » <a href="/posts/sphericalharmonics1">Spherical Harmonics and applications in real time graphics (part 2)</a>
</li>
    </ul>
  <h2>2016</h2>
    <h3>December</h3>
    <ul>
      <li>
<span>December 27, 2016</span> » <a href="/posts/sphericalharmonics0">Spherical Harmonics and applications in real time graphics</a>
</li>
    </ul>
    <h3>June</h3>
    <ul>
      <li>
<span>June 19, 2016</span> » <a href="/posts/juneupdate">Latest Update</a>
</li>
    </ul>
    </div>

        <div class="more">
          <a href="/archive" class="btn btn-small">read more..</a>
        </div>
      </div>
      <div class="_root">
        <h3 class="title"><a href="/categories">Categories</a><br/> <span class="date"></span></h3>

        <div class="summary ellipsis">
<ul class="tag_box inline">
  <li>
    <a href="/categories#XLE-ref">XLE <span>27</span></a>
  </li>
  <li>
    <a href="/categories#blog-ref">blog <span>1</span></a>
  </li>
  <li>
    <a href="/categories#Misc-ref">Misc <span>3</span></a>
  </li>
</ul>

  <h3>XLE (27)</h3>
  <ul>
      <li><a href="/posts/arealightsandpbr">Area Lights with Physically Based Rendering</a></li>
      <li><a href="/posts/assetpathscripts">Processing textures with the XLE scriptable asset path</a></li>
      <li><a href="/posts/compareoitrans">Comparing different methods for order independent transparency</a></li>
      <li><a href="/posts/environmentsample">Environment Sample Streamlining</a></li>
      <li><a href="/posts/envshots">Environment Rendering Screenshots</a></li>
      <li><a href="/posts/functionlinkedshaders">Dynamic Function Linking Graph for Shaders</a></li>
      <li><a href="/posts/improvedibl">Improved IBL</a></li>
      <li><a href="/posts/juneupdate">Latest Update</a></li>
      <li><a href="/posts/materialtool">Material and Node Diagram Tool</a></li>
      <li><a href="/posts/metallayerrefactoring">Vulkan prototype - metal layer refactoring</a></li>
      <li><a href="/posts/newtoolfeatures">Latest Tool Features</a></li>
      <li><a href="/posts/rectlightdiffuse">Rectangle Light diffuse vs 3DS Max</a></li>
      <li><a href="/posts/release0040">Release v0.04.0</a></li>
      <li><a href="/posts/transmissionnodegraph">Transmission Node Diagram</a></li>
      <li><a href="/posts/transmittedspecular">Transmitted specular</a></li>
      <li><a href="/posts/transmittedspecular2">Transmitted specular progress</a></li>
      <li><a href="/posts/transmittedspecular3">Transmitted specular</a></li>
      <li><a href="/posts/vulkan">Starting to experiment with Vulkan</a></li>
      <li><a href="/posts/vulkanbigissues">Vulkan prototype - the big issues</a></li>
      <li><a href="/posts/vulkandeclarativelightingparser">Vulkan prototype - how many separate render passes in the lighting parser?</a></li>
      <li><a href="/posts/vulkanmoreprogress">Vulkan latest progress -- core lighting working</a></li>
      <li><a href="/posts/vulkanprototypeslowprogress">Vulkan prototype slowly progressing</a></li>
      <li><a href="/posts/vulkanshaderprototype">HLSL shader prototype with Vulkan</a></li>
      <li><a href="/posts/vulkantips">Important Vulkan tips</a></li>
      <li><a href="/posts/vulkanworkshop2017">Vulkan Workshop / DevU 2017</a></li>
      <li><a href="/posts/whattodofirst">What to do first</a></li>
      <li><a href="/posts/workingonrectlights">Working some improvements to rectangle lights</a></li>
  </ul>
</div>

        <div class="more">
          <a href="/categories" class="btn btn-small">read more..</a>
        </div>
      </div>
      <div class="_root">
        <h3 class="title"><a href="/">Home</a><br/> <span class="date"></span></h3>

        <div class="summary ellipsis">
<p>This is a continuation of the tutorial on spherical harmonic applications for games. On the last page, we figured out the core math for integrating a basic diffuse BRDF with a spherical environment of incident light.</p>

<h2 id="toc_0">Efficient implementation</h2>

<p>So far, we've been dealing with spherical harmonics fairly abstractly. But now we can get down to a concrete use and some concrete code. Given our input texture (which effectively describes a sphere of incident light on a point) we want to calculate, for a given normal direction, what is the appropriate diffuse response.</p>

<p>To explain that more visually, here's the images from the first page. The first one is the input texture, and the second one is the matching diffuse response (with the same mapping).
<br><img src="/assets/media/SphericalHarmonics/mans_0.jpg">
<br><img src="/assets/media/SphericalHarmonics/reference.jpg">
<br>(images from sIBL Archive: <a href="http://www.hdrlabs.com/sibl/archive.html">http://www.hdrlabs.com/sibl/archive.html</a>)</p>

<p>Recall that we've expressed the BRDF as zonal harmonic coefficients and the incident light environment as spherical harmonic coefficients. We've established that we need to use a "convolve" operation to calculate how the BRDF reflects incident light to excident light (this effectively calculates the integral of the BRDF across the incident sphere). We also worked out that we need to rotate the BRDF in order to align it with the direction of the normal.</p>

<p>To refresh, here's the equation for convolution and rotation:
<br><img src="/assets/media/SphericalHarmonics/convolve.png"></p>

<p>The output of the convolve operation is a set of coefficients, and our final result will be the sum of those coefficients.</p>

<h3 id="toc_1">Simplifying</h3>

<p>Let's define <em>g</em> by rearranging the convolve equation:
<br><img src="/assets/media/SphericalHarmonics/convolve2.png"></p>
</div>

        <div class="more">
          <a href="/" class="btn btn-small">read more..</a>
        </div>
      </div>
      <div class="_root">
        <h3 class="title"><a href="/pages">Pages</a><br/> <span class="date"></span></h3>

        <div class="summary">
<ul>
  
    <li><a href="/about">About</a></li>
  
  
    <li><a href="/archive">Archive</a></li>
  
  
    <li><a href="/categories">Categories</a></li>
  
  
    <li><a href="/">Home</a></li>
  
    <li class="active"><a href="/pages" class="active">Pages</a></li>
  
  
  
    <li><a href="/tags">Tags</a></li>
  
</ul>
</div>

        <div class="more">
          <a href="/pages" class="btn btn-small">read more..</a>
        </div>
      </div>
    
    <div class="pagination">
      <ul>
          <li class="active"><a href="/index/1">1</a></li>
          <li><a href="/index/2">2</a></li>
      </ul>
    </div>
  </div>
</div>

      </div>

      <hr>
      <div class="footer">
        <p>&copy; XL Games 2015
          with help from <a href="http://ruhoh.com" target="_blank" title="The Definitive Technical Blogging Framework">ruhoh</a>
          and <a href="http://twitter.github.com/bootstrap/" target="_blank">Twitter Bootstrap</a>
        </p>
      </div>

    </div> <!-- /container -->

    <!-- Google Prettify -->
<script src="http://cdnjs.cloudflare.com/ajax/libs/prettify/188.0.0/prettify.js"></script>
<script>
  var pres = document.getElementsByTagName("pre");
  for (var i=0; i < pres.length; ++i) {
    pres[i].className = "prettyprint linenums";
  }
  prettyPrint();
</script>
<!-- end Google Prettify -->
    <script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-71034032-1']);
  _gaq.push(['_trackPageview']);
  

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>


    
  </body>
</html>
